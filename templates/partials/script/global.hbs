{{!< default}}
{{!-- 
/**
 * Uncertainty Project
 * Developed by Engagement Lab, 2016
 * ==============
 * 
 * Script include for global logic
 * ==========
 */
--}}

<script type="text/javascript">

	$(document).ready(function() {

		$('#menu-toggle').on('click', function(evt) {

			$('#sidebar-wrapper').show(function(){
				$('#menu-close').on('click', function(evt) {
					$('#sidebar-wrapper').animate({
						right: '100%'
					}, 500);

					setTimeout(function() {
						$('#sidebar-wrapper').hide();
					}, 600)
				});
			}).animate({
				right: '0px'
			}, 500);

		});

		{{#ifeq section 'portfolio'}}

			var filtered = 0;
			var filters = [];
			var container = $('#project-grid');


			$('.tag').on('click', function() {
				
				$(this).toggleClass('is-checked');

				applyFilter(this, $(this).hasClass('is-checked'));
				displayChecked(this, $(this).hasClass('is-checked'));
			});

			$('#project-grid').imagesLoaded( function() {
				
				var $filtered = $(container).isotope({
				    itemSelector: '.project-item',
				    filter: '*', 
				    masonry: {
					  gutter: 10
					}
				});

				$('.clear-all').trigger('click');

				var num = $filtered.isotope('getFilteredItemElements').length;
				checkFiltered(num, container, $filtered);
			});


			function displayChecked (elem, selected) {

				var selector = $(elem);
				var option = selector.data('filter-value');

				if ($('.filters-chosen').find('div').length > 0)
					$('.filters-chosen').css('display', 'inline-block');
				else
					$('.filters-chosen').hide();

			}

			function checkFiltered (num, container, filtered) {

				filtered.isotope('layout');

				filtered += num;
				
				if ( filtered === 0 ) {
				  $('.no-filtered-visible').show();
				} else {
					$('.no-filtered-visible').hide();
				}

			}
		    
		    function applyFilter(elem, selected) {

		    	filtered = 0;
					
			    var selector = $(elem);
			    			    
				if (selected) {
					if (selector.data('filter-value').length >= 1)
				    filters.push('.' + selector.data('filter-value').toString());
				} else {
					var index = filters.indexOf('.' + selector.data('filter-value').toString());
					if (index > -1) {
						filters.splice(index, 1);
					}
				}
			    			    
			    var filterStr = filters.join('');
			    
				var $filtered = $(container).isotope({ 
					filter: filterStr, 
					itemSelector: '.project-item' 
				});
				var num = $filtered.isotope('getFilteredItemElements').length;
				checkFiltered(num, container, $filtered);   

			}

			$(".clear-all").on('click', function() {
				
				filters = [];
				$(container).isotope({
			        filter: '*' 

				});
					
				$('.is-checked').removeClass('is-checked');
				$('.all-options').addClass('is-checked');
				$('.all-options').each(function(i, obj){
					applyFilter(this);
					displayChecked(this);
				});

			});

		{{/ifeq}}


	});
	
</script>